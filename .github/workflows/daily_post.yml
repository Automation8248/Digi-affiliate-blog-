name: Daily Health Blog Automation

on:
  schedule:
    # Ye time set hai: Rozana 10:00 AM UTC (India mein dopahar ke 3:30 baje ke aas-paas)
    - cron: '0 10 * * *'
  
  # Ye manual button hai, taaki aap jab chahein tab "Run Workflow" click karke test kar sakein
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest

    # IMP: Ye permission zaroori hai taaki script 'history.json' ko edit karke save kar sake
    permissions:
      contents: write

    steps:
      - name: Checkout Code
        uses: actions/checkout@v3

      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.9'

      - name: Install Dependencies
        run: |
          python -m pip install --upgrade pip
          pip install google-api-python-client google-auth google-auth-oauthlib google-auth-httplib2 openai

      - name: Run Automation Script
        env:
          # Ye Secrets aapko GitHub Settings -> Secrets and Variables -> Actions mein daalne hain
          GH_MARKETPLACE_TOKEN: ${{ secrets.GH_MARKETPLACE_TOKEN }}
          BLOGGER_ID: ${{ secrets.BLOGGER_ID }}
          GOOGLE_CREDENTIALS_JSON: ${{ secrets.GOOGLE_CREDENTIALS_JSON }}
        run: python main.py

      - name: Commit and Push History (Save Memory)
        run: |
          git config --global user.name "GitHub Action"
          git config --global user.email "action@github.com"
          # Sirf history file ko add karenge
          git add history.json
          # Agar file update hui hai to commit karega, nahi to error nahi dega
          git commit -m "Auto-update product history log [skip ci]" || echo "No changes to commit"
          git push
